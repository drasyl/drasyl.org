<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
	{{ partialCached "head.html" . }}
	<body class="blog-details-page single single-{{ .Type | singularize }}">
		{{ partialCached "header.html" . }}
		<main class="main">

			<!-- Page Title -->
			<div class="page-title" data-aos="fade">
				<div class="container">
					<nav class="breadcrumbs">
						<ol>
							<li><a href="{{ .Site.BaseURL }}">Home</a></li>
							<li><a href="{{ .Site.BaseURL }}blog/">Blog</a></li>
							<li class="current">{{ .Title }}</li>
						</ol>
					</nav>
					<h1>{{ .Title }}</h1>
				</div>
			</div><!-- End Page Title -->

			<div class="container">
				<div class="row">

					<div class="col-lg-8">

						<!-- Blog Details Section -->
						<section id="blog-details" class="blog-details section">
							<div class="container" data-aos="fade-up">

								<article class="article">

									{{/* HERO IMAGE (optimized) */}}
									{{ $post := . }}
									{{ $imgParam := "" }}
									{{ if .Params.images }}
									  {{ $imgParam = (index .Params.images 0) }}
									{{ else if .Params.image }}
									  {{ $imgParam = .Params.image }}
									{{ end }}

									{{ $img := false }}
									{{ with $imgParam }}
									  {{/* Try Page Resource (works with page bundles) */}}
									  {{ with $post.Resources.GetMatch (printf "**%s" (path.Base .)) }}
									    {{ $img = . }}
									  {{ end }}
									{{ end }}

									{{/* If not found as Page Resource, try global Assets (e.g., assets/img/...) */}}
									{{ if (not $img) }}
									  {{ with $imgParam }}
									    {{ $clean := strings.TrimPrefix "/" . }}
									    {{ $clean = (strings.TrimPrefix "assets/" $clean) }}
									    {{ with resources.Get $clean }}
									      {{ $img = . }}
									    {{ end }}
									  {{ end }}
									{{ end }}

									{{ if or $img $imgParam }}
									  <div class="hero-img" data-aos="zoom-in">
									    {{ if $img }}
									      {{/* Generate responsive variants for hero */}}
									      {{ $avif1200 := $img.Resize "1200x q70 avif" }}
									      {{ $avif1600 := $img.Resize "1600x q70 avif" }}
									      {{ $avif2000 := $img.Resize "2000x q70 avif" }}

									      {{ $webp1200 := $img.Resize "1200x q75 webp" }}
									      {{ $webp1600 := $img.Resize "1600x q75 webp" }}
									      {{ $webp2000 := $img.Resize "2000x q75 webp" }}

									      {{ $jpg1600 := $img.Resize "1600x q80" }}

									      <picture>
									        <source type="image/avif" srcset="{{ $avif1200.RelPermalink }} 1200w, {{ $avif1600.RelPermalink }} 1600w, {{ $avif2000.RelPermalink }} 2000w" sizes="(min-width: 1200px) 1200px, 100vw">
									        <source type="image/webp" srcset="{{ $webp1200.RelPermalink }} 1200w, {{ $webp1600.RelPermalink }} 1600w, {{ $webp2000.RelPermalink }} 2000w" sizes="(min-width: 1200px) 1200px, 100vw">
									        <img src="{{ $jpg1600.RelPermalink }}" alt="{{ .Title }}" class="img-fluid" width="{{ $jpg1600.Width }}" height="{{ $jpg1600.Height }}" loading="eager" decoding="async" fetchpriority="high">
									      </picture>
									    {{ else }}
									      {{/* Static fallback (e.g., /static/img/…) with width/height via imageConfig and optional .webp sibling */}}
									      {{ $clean := strings.TrimPrefix "/" $imgParam }}
									      {{ $abs := printf "static/%s" $clean }}
									      {{ $cfg := false }}
									      {{ if (fileExists $abs) }}
									        {{ $cfg = (imageConfig $abs) }}
									      {{ end }}
									      {{ $webpRel := replaceRE "\\.[^./]+$" ".webp" $clean }}
									      {{ $webpAbs := printf "static/%s" $webpRel }}
									      {{ $hasWebp := fileExists $webpAbs }}
									      {{ $avifRel := replaceRE "\\.[^./]+$" ".avif" $clean }}
									      {{ $avifAbs := printf "static/%s" $avifRel }}
									      {{ $hasAvif := fileExists $avifAbs }}
									      <picture>
									        {{ if $hasAvif }}
									          <source type="image/avif" srcset="/{{ $avifRel }}" sizes="(min-width: 1200px) 33vw, (min-width: 768px) 50vw, 100vw">
									        {{ end }}
									        {{ if $hasWebp }}
									          <source type="image/webp" srcset="/{{ $webpRel }}" sizes="(min-width: 1200px) 33vw, (min-width: 768px) 50vw, 100vw">
									        {{ end }}
									        <img
									          class="img-fluid"
									          src="/{{ $clean }}"
									          alt="{{ .Title }}"
									          {{ with $cfg }}width="{{ .Width }}" height="{{ .Height }}"{{ end }}
									          loading="eager"
									          decoding="async"
									          fetchpriority="high">
									      </picture>
									    {{ end }}
									    <div class="meta-overlay">
									      <div class="meta-categories">
									        <span class="reading-time"><i class="bi bi-clock"></i> {{ .ReadingTime }} min read</span>
									      </div>
									    </div>
									  </div>
									{{ end }}

									<div class="article-content" data-aos="fade-up" data-aos-delay="100">
										<div class="content-header">
											<h1 class="title">{{ .Title }}</h1>

											<div class="author-info">
												{{ if .Params.author }}
												<div class="author-details">
													{{ if eq .Params.author "Heiko Bornholdt" }}
													<img src="{{ "img/team/hb.jpg" | relURL }}" alt="{{ .Params.author }}" class="author-img">
													{{ else if eq .Params.author "Kevin Röbert" }}
													<img src="{{ "img/team/kr.webp" | relURL }}" alt="{{ .Params.author }}" class="author-img">
													{{ end }}
													<div class="info">
														<h4>{{ .Params.author }}</h4>
														{{ if eq .Params.author "Heiko Bornholdt" }}
														<span class="role">Senior Research Assistant</span>
														{{ else if eq .Params.author "Kevin Röbert" }}
														<span class="role">Research Assistant</span>
														{{ else if .Params.author_role }}
														<span class="role">{{ .Params.author_role }}</span>
														{{ else }}
														<span class="role">Author</span>
														{{ end }}
													</div>
												</div>
												{{ end }}
												<div class="post-meta">
													<span class="date"><i class="bi bi-calendar3"></i> {{ .Date.Format "Jan 2, 2006" }}</span>
													{{ if .Params.tags }}
													<span class="divider">•</span>
													<span class="tags"><i class="bi bi-tags"></i> 
														{{ range $index, $tag := .Params.tags }}
														{{ if gt $index 0 }}, {{ end }}
														<a href="{{ "tags/" | relURL }}{{ $tag | urlize }}">{{ $tag }}</a>
														{{ end }}
													</span>
													{{ end }}
												</div>
											</div>
										</div>

										<div class="content">
											{{ .Content }}
										</div>

										<div class="meta-bottom">
											<!-- {{ if .Params.tags }}
											<div class="tags-section">
												<h4>Related Topics</h4>
												<div class="tags">
													{{ range .Params.tags }}
													<a href="{{ "tags/" | relURL }}{{ . | urlize }}" class="tag">{{ . }}</a>
													{{ end }}
												</div>
											</div>
											{{ end }} -->

											<div class="share-section">
												<h4>Share Article</h4>
												<div class="social-links">
													<a href="https://x.com/intent/tweet?text={{ .Title }}&url={{ .Permalink }}" class="twitter" target="_blank" rel="noopener"><i class="bi bi-twitter-x"></i></a>
													<a href="https://www.facebook.com/sharer/sharer.php?u={{ .Permalink }}" class="facebook" target="_blank" rel="noopener"><i class="bi bi-facebook"></i></a>
													<a href="https://www.linkedin.com/sharing/share-offsite/?url={{ .Permalink }}" class="linkedin" target="_blank" rel="noopener"><i class="bi bi-linkedin"></i></a>
													<a href="https://mastodon.social/share?text={{ .Title }}%20{{ .Permalink }}" class="mastodon" target="_blank" rel="noopener"><i class="bi bi-mastodon"></i></a>
												</div>
											</div>
										</div>
									</div>

								</article>

							</div>
						</section><!-- /Blog Details Section -->

					</div>

					<div class="col-lg-4 sidebar">

						<div class="widgets-container" data-aos="fade-up" data-aos-delay="200">

							<!-- Recent Posts Widget -->
							<div class="recent-posts-widget widget-item">

								<h3 class="widget-title">Recent Posts</h3>

								{{ range first 5 (where .Site.RegularPages "Type" "blog") }}
								<div class="post-item">
									{{/* Thumbnail (optimized) */}}
									{{ $p := . }}
									{{ $thumbParam := "" }}
									{{ if .Params.images }}
									  {{ $thumbParam = (index .Params.images 0) }}
									{{ else if .Params.image }}
									  {{ $thumbParam = .Params.image }}
									{{ end }}
									{{ $thumb := false }}
									{{ with $thumbParam }}
									  {{ with $p.Resources.GetMatch (printf "**%s" (path.Base .)) }}
									    {{ $thumb = . }}
									  {{ end }}
									{{ end }}
									{{ if (not $thumb) }}
									  {{ with $thumbParam }}
									    {{ $clean := strings.TrimPrefix "/" . }}
									    {{ $clean = (strings.TrimPrefix "assets/" $clean) }}
									    {{ with resources.Get $clean }}
									      {{ $thumb = . }}
									    {{ end }}
									  {{ end }}
									{{ end }}
									{{ if $thumb }}
									  {{ $twebp := $thumb.Fill "80x80 q75 webp" }}
									  {{ $tjpg := $thumb.Fill "80x80 q80" }}
									  <picture>
									    <source type="image/webp" srcset="{{ $twebp.RelPermalink }}">
									    <img src="{{ $tjpg.RelPermalink }}" alt="{{ .Title }}" class="flex-shrink-0" width="80" height="80" loading="lazy" decoding="async" fetchpriority="low" style="aspect-ratio:1/1; object-fit:cover;">
									  </picture>
									{{ else if $thumbParam }}
									  {{ $clean := strings.TrimPrefix "/" $thumbParam }}
									  {{ $abs := printf "static/%s" $clean }}
									  {{ $cfg := false }}
									  {{ if (fileExists $abs) }}
									    {{ $cfg = (imageConfig $abs) }}
									  {{ end }}
									  <img src="/{{ $clean }}" alt="{{ .Title }}" class="flex-shrink-0" width="80" height="80" loading="lazy" decoding="async" fetchpriority="low" style="aspect-ratio:1/1; object-fit:cover;">
									{{ end }}
									<div>
										<h4><a href="{{ .RelPermalink }}">{{ .Title }}</a></h4>
										<time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Jan 2, 2006" }}</time>
									</div>
								</div><!-- End recent post item-->
								{{ end }}

							</div><!--/Recent Posts Widget -->

							<!-- Tags Widget -->
							<div class="tags-widget widget-item">

								<h3 class="widget-title">Tags</h3>
								<ul>
									{{ range .Site.Taxonomies.tags }}
									<li><a href="{{ .Page.RelPermalink }}">{{ .Page.Title }}</a></li>
									{{ end }}
								</ul>

							</div><!--/Tags Widget -->

						</div>

					</div>

				</div>
			</div>

		</main>
		{{ partialCached "footer.html" . }}

		<!-- Scroll Top -->
		<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

		<!-- Vendor JS Files -->
		<script src="{{ "vendor/bootstrap/js/bootstrap.bundle.min.js" | relURL }}"></script>
		<script src="{{ "vendor/aos/aos.js" | relURL }}"></script>

		<!-- Main JS File -->
		{{ $script := resources.Get "js/main.js" }}
		<script src="{{ ($script | minify | fingerprint).RelPermalink}}"></script>
	</body>
</html>
